from bs4 import BeautifulSoup as bs 
import mysql.connector as db
#import pymysql as db
import re
import os
import sys
import json

db_config = {
	'host':	        '127.0.0.1',
	'port':		3306,
	'user':		'root',
	'passwd':	'root',
	'db':	'cnl'
}
conn = db.connect(**db_config)
cursor = conn.cursor()
conn1 = db.connect(**db_config)
cursor1 = conn1.cursor()

def set_type():
    sql = 'SELECT id, extra1 FROM vuln_exploit_fetched'
    cursor.execute(sql)
    for row in cursor:
        tmps = row[1].split('\n')
        for tmp in tmps:
            cve_id = ''
            sql = 'INSERT IGNORE INTO vuln_exploits (exploit_db_id, cve_id) VALUES(%s, %s)'
            src = re.search(r'CVE:\s*\d{4}-\d{4}', tmp)
            if src:
                cve_id = src.group().replace(': ', '-').rstrip().lstrip()
                cursor1.execute(sql, (row[0], cve_id))
                conn1.commit()
            src = re.search(r'CVE-\d{4}-\d{4}', tmp)
            if src:
                cve_id = src.group()
                cursor1.execute(sql, (row[0], cve_id))
                conn1.commit()
                    

if __name__ == '__main__':
    set_type()
    cursor.close()
    cursor1.close()
    conn.close()
    conn1.close()
