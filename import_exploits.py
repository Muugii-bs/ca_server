import mysql.connector as db
import sys
import json

db_config = {
		'host':			'127.0.0.1',
		'port':			3306,
		'user':			'root',
		'password':	'root',
		'database':	'cnl',
		'autocommit': True,
}
conn = db.connect(**db_config)
cursor = conn.cursor()

def exploit_parse(_file):
    with open(_file, 'r') as fp:
        for line in fp:
            line = line.split()
            exploit_id = line[0].split(':')[1]
            cves = line[1:]
            for cve in cves:
                sql = "INSERT IGNORE INTO vuln_exploits (exploit_db_id, cve_id) VALUES (%s, %s)"
                cursor.execute(sql, (exploit_id, cve))
        
def main():
	exploit_parse(sys.argv[1])
        cursor.close()
	conn.close()

if __name__ == '__main__':
	main()

